<!doctype html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>go OFFLINE</title>
<style>
body {
  font-family: Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace;
  max-width: 500px;
  margin: 100px auto;
}

.offline #offline {
  color: green;
}

.title {
  font-size: 50px;
}

.i {
  position: relative;
}

.score {
  opacity: 0;
}

.offline .score {
  opacity: 1;
}

.wifi {
  position: absolute;
  top: -25px;
  left: 50%;
  margin-left: -25px;
}

/* https://codepen.io/GilSanchez/pen/rusAy */
.wifi {
	padding: 5px;
}

.wifi, .wifi:before {
	display: block;
	border: 15px double transparent;
	border-top-color: currentColor;
	border-radius: 50%;
}

.wifi::before {
	content: '';
	width: 0; height: 0;
  border: 5px solid transparent;
	border-top-color: currentColor;
}

.offline .wifi {
  border-color: transparent;
}


</style>
<body>
<h1 class="title">
  go <span id="offline">OFFL<span class="i">I<span class="wifi"></span></span>NE</span>
</h1>
<p>HI SCORE: <span id="js-hiscore">0</span></p>
<p class="score">&nbsp;&nbsp;&nbsp;SCORE: <span id="js-score">0</span></p>

<script>
// TODO: enable offline service worker
// if ('serviceWorker' in navigator) {
//   navigator.serviceWorker
//      .register('sw.js');
// }

  var defaultGameData = { hiScore: 0 };

  function readGameData() {
    if (localStorage) {
      var gameData = defaultGameData;

      try {
        gameData = JSON.parse(localStorage.getItem('GO_OFFLINE_DATA'));
      } catch(e) {
        // ignore and return default
      }
    }

    return gameData;
  }

  function saveGameData(data) {
    if (localStorage) {
      try {
        localStorage.setItem('GO_OFFLINE_DATA', JSON.stringify(data))
      } catch (e) {
        // silently ignore
      }
    }
  }

  var data = readGameData();
  console.log(data);

  document.querySelector('#js-hiscore').innerHTML = data.hiScore;

  if ('onLine' in navigator) {
    var offline = navigator.onLine === false;

    if (offline) {
      onOffline();
    }

    var score;
    var scoreTick;

    function onOffline() {
      score = 0;
      document.querySelector('#js-score').innerHTML = score;
      document.body.classList.add('offline');

      scoreTick = window.setInterval(function () {
        if (!document.hidden) {
          score++;
          document.querySelector('#js-score').innerHTML = score;
        }
      }, 1000)
    }

    function onOnline() {
    	document.body.classList.remove('offline');
      if (score > data.hiScore) {
        data.hiScore = score;
        document.querySelector('#js-hiscore').innerHTML = data.hiScore;
        saveGameData(data);
      }
      window.clearInterval(scoreTick);
    }

    window.addEventListener('offline', onOffline);
    window.addEventListener('online', onOnline);
  }
</script>
</body>
</html>
